---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/UI/Navbar.jsx";
import Sidebar from "../components/UI/Sidebar.astro";
import HomePage from "../components/HomePage.jsx";
---

<Layout>
    <Navbar client:load />
    <Sidebar client:load />
    <HomePage client:load />

    <script is:inline>
        window.API_BASE = "http://localhost:8000";
    </script>
    <script src="/scripts/Random_ayah.js" is:inline></script>

    <script type="module" define:vars={{ base: import.meta.env.BASE_URL }}>
        const locationServiceUrl = `${base}utils/LocationService.js`.replace(/\/+/g, "/");
        const locationService = await import(locationServiceUrl).then((m) => m.default);

        // Initialize location button
        document.addEventListener("DOMContentLoaded", () => {
            const locationBtn = document.getElementById("location");

            if (locationBtn) {
                locationBtn.addEventListener("click", async () => {
                    try {
                        // Show loading state
                        locationBtn.disabled = true;
                        locationBtn.innerHTML = `
            <span class="loading loading-spinner loading-sm"></span>
            Getting Location...
          `;

                        // Get location using the LocationService
                        const location = await locationService.getLocation();

                        // Show success state
                        locationBtn.innerHTML = `
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
            </svg>
            Location Set!
          `;

                        // Reload page after delay to update prayer times
                        setTimeout(() => {
                            window.location.reload();
                        }, 1500);
                    } catch (error) {
                        console.error("Location error:", error);

                        // Show error state
                        locationBtn.innerHTML = `
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            Try Again
          `;

                        // Re-enable button
                        locationBtn.disabled = false;
                    }
                });
            }
        });
    </script>
</Layout>
